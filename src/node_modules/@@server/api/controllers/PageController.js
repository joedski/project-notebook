const { knex } = require('@@server/api/utils/knex')

module.exports = ({ controllers, models }) => ({
  async getPages({
    offset = 0,
    limit = 0,
  } = {}) {
    return knex.transaction(trx => {
      return models.Page.getPages(trx, { offset, limit })
    })
    // TODO: Better error messaging?
    // .catch(error => {
    //   console.error(error)
    //   throw new Error('Error retrieving pages')
    // })
  },

  async createPage(pageProps) {
    return knex.transaction(async (trx) => {
      const [pageId] = await models.Page.createPage(trx, pageProps)
      return models.Page.getPageById(trx, pageId)
    })
    // TODO: Better error messaging?
    // .catch(error => {
    //   console.error(error)
    //   throw new Error('Error creating page')
    // })
    //
    // return {
    //   ...pageProps,
    //   id: 0,
    //   created_at: Date.now(),
    // }
  },
})
