const { knex } = require('@@server/api/utils/knex')
const { withLimitOffset } = require('@@server/api/utils/queryModifiers')

module.exports = ({ models }) => ({
  getPages(trx, {
    limit = 0,
    offset = 0,
  } = {}) {
    return trx
    .from('page')
    .select()
    .modify(withLimitOffset, limit, offset)
  },

  async getPageById(trx, pageId) {
    const [page] = await trx
    .from('page')
    .select()
    .where({ id: pageId })

    return page
  },

  async createPage(trx, pageProps) {
    const [pageId] = await trx
    .returning('id')
    .into('entity')
    .insert({})

    return trx
    .returning('id')
    .into('page')
    .insert({
      ...pageProps,
      id: pageId,
    })
  },

  async updatePage(trx, pageId, pageProps) {
    await trx('page')
    .update(pageProps)
    .where({ id: pageId })

    return trx
    .from('page')
    .select()
    .where({ id: pageId })
  },
})
